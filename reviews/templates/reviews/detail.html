{% extends 'base.html' %}
{% load django_bootstrap5 %}
{% block content %}
  <h1>detail.html</h1>
  <a href="{% url 'reviews:update' review.pk%}" class='btn btn-success'>수정하기</a>
  <form action="{% url 'reviews:delete' review.pk %}" method='POST'>
    {% csrf_token %}
    <input type="submit" value='삭제' class='btn btn-danger'>
  </form>
  <div class="">
    <p>즐겨찾기</p>
    {% if review.image %}
      <img src="{{ review.image.url }}" alt="{{review.image}}">
    {% endif %}
    <h3 >
      가게 이름: <span id='store_name'>{{ review.store_name }}</span>
    </h3>

    <p>
      주소: <span id="address_">{{ review.store_address }}</span>
    </p>
    <p>
      전화번호: {{ review.phoneNumber }}
    </p>
    <p>
      주차가능: {{ review.parking }}
    </p>
    <p>
      가격대: {{ review.price }}
    </p>
    <p>
      영업시간: {{ review.time }}
    </p>
    <p>
      쉬는 시간: {{ review.breaktime }}
    </p>
    <p>
      맛집정보: {{ review.content }}
    </p>
    <div class="" id='map' style='width:500px; height:500px;'></div>
  </div>
  <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
    이 집 평가하자
  </button>
{% comment %} 댓글 {% endcomment %}
  <h2>맛 평가 리스트</h2>
  {% for comment in comments %}
  <p>맛 평가:{{ comment.grade }}점</p>
  <p>작성일:{{ comment.created_at }}</p>
  <p>추천:{{ comment.tag }}</p>
  <p>추천: {{ comment.content }}</p>
  {% if comment.image %}
      <img src="{{ comment.image.url }}" alt="{{comment.image}}" width='180px;'>
    {% endif %}

  {% endfor %}
  
<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">리뷰 작성</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">

  <form action="{% url 'reviews:comment_create' review.pk %}" method='POST' enctype="multipart/form-data">
    {% csrf_token %}
    {% bootstrap_form comment_form %}
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
    <input type="submit" class="btn btn-primary">리뷰 작성</input>
  </form>
      </div>
    </div>
  </div>
</div>

  <script>
    var mapContainer = document.getElementById('map'), // 지도를 표시할 div
      mapOption = {
        center: new kakao
          .maps
          .LatLng(33.450701, 126.570667), // 지도의 중심좌표
        level: 3 // 지도의 확대 레벨
      };

    // 지도를 생성합니다
    var map = new kakao
      .maps
      .Map(mapContainer, mapOption);

    // 주소-좌표 변환 객체를 생성합니다
    var geocoder = new kakao
      .maps
      .services
      .Geocoder();

    // 주소로 좌표를 검색합니다 {{ review.store_address  }} 느낌
    const address_ = document.querySelector('#address_')
    console.log(address_.innerText)
    geocoder.addressSearch(`${address_.innerText}`, function (result, status) {

      // 정상적으로 검색이 완료됐으면
      if (status === kakao.maps.services.Status.OK) {

        var coords = new kakao
          .maps
          .LatLng(result[0].y, result[0].x);

        // 결과값으로 받은 위치를 마커로 표시합니다
        var marker = new kakao
          .maps
          .Marker({map: map, position: coords});

        // 인포윈도우로 장소에 대한 설명을 표시합니다
        const store_name = document.querySelector('#store_name')
        var infowindow = new kakao
          .maps
          .InfoWindow({content: `'<div style="width:150px;text-align:center;padding:6px 0;">${store_name.innerText} </div>'`});
        infowindow.open(map, marker);

        // 지도의 중심을 결과값으로 받은 위치로 이동시킵니다
        map.setCenter(coords);
      }
    });
  </script>
{% endblock content %}
{% block script %}
{% comment %} 비동기 즐겨찾기 {% endcomment %}




{% endblock script %}